<!DOCTYPE html>
<html>
<head>
  <title>My First Node Chat App</title>

  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

<!-- jQuery library -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!-- Popper JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

<!-- Latest compiled JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>


<script src="/socket.io/socket.io.js"></script>
<style>
  .blueText {
    text-align:left;
    color: #00F;
    display:block;
}
.greenText {
  text-align:right;
    color: #0F0;
    display:block;

}
img {
  border-radius: 50%;
}
#messages{
  height: 250px;
  overflow:scroll;
}
.spacial{
  display:inline;
}
li{
  transition: 1s;
  transform:translateY: 1000px !important;
}
.coming{
  transition: 1s;
  transform:translateY: 0px !important;
}
.jumbotron {
  max-height: 300px;margin: 5px auto;padding :15px;
}

.display-4 {
  font-size 1em; margin: 5px auto;
}
</style>
</head>
<body>
<div class="container">
    <br>
    <div class="jumbotron">
        <h1 class="display-4">Send Message</h1>
        <br>
        <input id = "name" class="form-control" placeholder="Name">
        <br>
        <textarea id = "message" class="form-control" placeholder="Your Message Here" maxlength="50"></textarea>
        <br>
        <button id="send" class="btn btn-success">Send</button>
    </div>

</div>
<div id="messages">
  <div id="textdiv">
</div>
</div>
<script>
  var socket = io();

  socket.emit('clientEvent', 'Sent an event from the client!');
      $(() => {
          $("#send").click(()=>{
              sendMessage({name: $("#name").val(), message: $("#message").val()});
          })
          getMessages();

      })
      socket.on('message', addMessages)
      socket.on('testerEvent', function(data){
console.log(data);

 $("#textdiv").append(` <li class='blueText'> ${data.description} </li> `);
        });

        socket.on('disconnect', function(data){
  console.log(data);

   $("#textdiv").append(` <li class='blueText'> ${data.description} </li> `);
          });





      function addMessages(message){

      if ($("li").length % 2 === 0) {
         $("#textdiv").append(` <li class='blueText'> <img src="//unsplash.it/50/50"/> ${message.name} </li>  <p class='blueText'> ${message.message} </p> <span class='blueText'>Posted on: ${message.time.slice(0, 10) } <span class='spacial'> at: ${message.time.slice(11, 19) }</span> </span>`);
        $("#messages").scrollTop($("#textdiv").outerHeight());
    $("#textdiv").fadeOut(0).fadeIn(600);
      }
    else {
       $("#textdiv").append(` <li class='greenText'> ${message.name}  <img src="//unsplash.it/50/50"/> </li> <p class='greenText' > ${message.message} </p> <span class='greenText'>Posted on:  ${message.time.slice(0, 10) } <span class='spacial'> at: ${message.time.slice(11, 19) }</span> </span>`);
       $("#messages").scrollTop($("#textdiv").outerHeight());
  $("#textdiv").fadeOut(0).fadeIn(600);
      }}

  //function addMessages(message){
//  const messageClass = message.user === currentUser ? 'blueText' : 'greenText'

  //$("#messages").append(`<li class="${messageClass}"> ${message.name} </li> <p>
//  ${message.message} </p> <span> ${message.id} </span>`)
//}
      function getMessages(){
        $.get('http://localhost:3000/messages', (data) => {

          data.forEach(addMessages);
          console.log(data);
        })
      }
      function sendMessage(message){
        $.post('http://localhost:3000/messages', message);
      //  console.log(message); // {name: "this", message: "that"}
      }
</script>
</body>
</html>
